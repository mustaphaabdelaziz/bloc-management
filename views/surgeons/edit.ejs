<% layout('layouts/boilerplate') %>
<!-- views/surgeons/edit.ejs -->
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-pencil me-2"></i>Modifier Chirurgien
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" action="/surgeons/<%= surgeon._id %>?_method=PUT">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="code" class="form-label">Code *</label>
                                <input type="text" class="form-control" id="code" name="code" value="<%= surgeon.code %>" readonly required>
                                <div class="form-text">
                                    <i class="bi bi-lock me-1"></i>
                                    Le code ne peut pas être modifié une fois généré
                                </div>
                            </div>
                        </div>
                       <div class="col-md-6">
    <div class="mb-3">
        <label for="specialty" class="form-label">Spécialité *</label>
        <select name="specialty" id="specialty" class="form-select" required>
            <% specialties.forEach(specialty => { %>
                <option value="<%= specialty._id %>"<%= surgeon.specialty._id.toString() === specialty._id.toString() ? ' selected' : '' %>>
                    <%= specialty.name %>
                </option>
            <% }) %>
        </select>
    </div>
</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="firstName" class="form-label">Prénom *</label>
                                <input type="text" class="form-control" id="firstName" name="firstName" value="<%= surgeon.firstName %>" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="lastName" class="form-label">Nom *</label>
                                <input type="text" class="form-control" id="lastName" name="lastName" value="<%= surgeon.lastName %>" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dateOfBirth" class="form-label">Date de naissance *</label>
                                <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" 
                                       value="<%= moment(surgeon.dateOfBirth).format('YYYY-MM-DD') %>" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="phone" class="form-label">Téléphone</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="<%= surgeon.phone || '' %>">
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0">Configuration du Contrat</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="contractType" class="form-label">Type de contrat *</label>
                                <select name="contractType" id="contractType" class="form-select" required onchange="toggleContractFields()">
                                    <option value="allocation" <%= surgeon.contractType === 'allocation' ? 'selected' : '' %>>
                                        Allocation de salle d'opération
                                    </option>
                                    <option value="percentage" <%= surgeon.contractType === 'percentage' ? 'selected' : '' %>>
                                        Pourcentage
                                    </option>
                                </select>
                            </div>
                            
                            <div id="allocationFields">
                                <div class="mb-3">
                                    <label for="allocationRate" class="form-label">Taux horaire (DA/heure)</label>
                                    <input type="number" class="form-control" id="allocationRate" name="allocationRate" 
                                           value="<%= surgeon.allocationRate || '' %>" min="0" step="100">
                                </div>
                            </div>
                            
                            <div id="percentageFields">
                                <div class="mb-3">
                                    <label for="percentageRate" class="form-label">Pourcentage (%)</label>
                                    <input type="number" class="form-control" id="percentageRate" name="percentageRate" 
                                           value="<%= surgeon.percentageRate || '' %>" min="0" max="100" step="0.1">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="/surgeons/<%= surgeon._id %>" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Annuler
                        </a>
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-save me-2"></i>Sauvegarder
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
function toggleContractFields() {
    const contractType = document.getElementById('contractType').value;
    const allocationFields = document.getElementById('allocationFields');
    const percentageFields = document.getElementById('percentageFields');
    
    if (contractType === 'allocation') {
        allocationFields.style.display = 'block';
        percentageFields.style.display = 'none';
    } else {
        allocationFields.style.display = 'none';
        percentageFields.style.display = 'block';
    }
}
document.addEventListener('DOMContentLoaded', function() {
    toggleContractFields();
});
</script>
